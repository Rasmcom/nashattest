<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ - Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Cairo', sans-serif;
        }

        .gradient-header {
            background: linear-gradient(135deg, #00A383 0%, #0093B5 100%);
        }

        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .dropdown-content.active {
            max-height: 5000px;
            transition: max-height 0.5s ease-in;
        }

        .rotate-arrow {
            transform: rotate(180deg);
            transition: transform 0.3s ease;
        }

        .header-input {
            background-color: transparent;
            border: none;
            color: white;
            padding: 0;
            margin: 0;
            width: 100%;
            text-align: right;
        }
        .header-input::placeholder {
            color: rgba(255, 255, 255, 0.8);
            opacity: 1;
        }

        summary {
            list-style: none;
            cursor: pointer;
        }
        summary::-webkit-details-marker {
            display: none;
        }
        
        #date-picker-modal .week-grid .day.selected {
            background-color: #10B981;
            color: white;
            border-color: #059669;
        }
        #date-picker-modal .week-grid .day.disabled {
            background-color: #F3F4F6;
            color: #9CA3AF;
            cursor: not-allowed;
        }

        @media print {
            .no-print { display: none !important; }
            @page { 
                size: A4 landscape; 
                margin: 0; 
            } 
            body { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
                margin: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Date Picker Modal -->
    <div id="date-picker-modal" class="fixed inset-0 z-40 items-center justify-center p-4 no-print bg-black bg-opacity-50 hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-4xl w-full">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Ø§Ø®ØªØ± ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</h3>
            <div id="modal-weeks-container" class="space-y-4 max-h-96 overflow-y-auto"></div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeDatePicker()" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400">Ø¥Ù„ØºØ§Ø¡</button>
                <button onclick="saveDates()" class="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700">Ø­ÙØ¸ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div id="main-content" class="transition-opacity duration-500">
        <!-- Header Section -->
        <header class="gradient-header text-white py-4 shadow-lg no-print">
            <div class="container mx-auto px-6 flex justify-between items-center">
                <div class="flex items-center gap-4">
                    <img src="https://j.top4top.io/p_3516qltr40.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ²Ø§Ø±Ø©" class="h-16 sm:h-20">
                    <!-- START OF CHANGE: Replaced fixed width (w-96) with responsive classes -->
                    <div class="flex flex-col gap-0 w-full max-w-xs sm:max-w-sm">
                    <!-- END OF CHANGE -->
                        <input type="text" id="education-admin" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©" class="header-input text-sm font-semibold" onblur="saveState()">
                        <input type="text" id="education-region" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©" class="header-input text-sm font-semibold" onblur="saveState()">
                        <input type="text" id="school-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="header-input text-sm font-semibold" onblur="saveState()">
                    </div>
                </div>
                <div class="text-center">
                    <h1 id="main-title" class="text-xl sm:text-3xl font-bold">Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                    <p id="stage-title-header" class="text-lg sm:text-2xl font-bold text-white h-8"></p>
                    <p id="subtitle" class="text-md sm:text-lg opacity-90">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ 1447Ù‡Ù€</p>
                </div>
            </div>
        </header>

        <!-- Controls Section -->
        <section class="py-8 bg-gray-50 no-print">
            <div class="container mx-auto px-6">
                <div class="mb-8 text-center p-6 bg-white rounded-lg shadow-md">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</h3>
                            <div class="flex justify-center gap-3">
                                <button onclick="selectRegion('other')" id="btn-other-region" class="px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg">Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚</button>
                                <button onclick="selectRegion('western')" id="btn-western-region" class="px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØºØ±Ø¨ÙŠØ©</button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-4">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø®Ø·Ø©:</h3>
                            <div class="flex flex-wrap justify-center gap-3">
                                <button onclick="toggleStageFilter('all')" id="btn-all" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg">ğŸ« Ø§Ù„ÙƒÙ„</button>
                                <button onclick="toggleStageFilter('primary')" id="btn-primary" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">ğŸŒ± Ø§Ù„Ø£ÙˆÙ„ÙŠØ©</button>
                                <button onclick="toggleStageFilter('upper-primary')" id="btn-upper-primary" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">ğŸŒ¿ Ø§Ù„Ø¹Ù„ÙŠØ§</button>
                                <button onclick="toggleStageFilter('middle')" id="btn-middle" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">ğŸŒ³ Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©</button>
                                <button onclick="toggleStageFilter('high')" id="btn-high" class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700">ğŸ“ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</button>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 flex gap-4 justify-center">
                        <button onclick="clearAllFilters()" class="text-sm text-gray-500 hover:text-gray-700 underline">Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø§Ø­Ù„</button>
                        <button onclick="printSchedule()" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„</button>
                        <button onclick="resetPlan()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø®Ø·Ø©</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content: Activity Tables -->
        <main class="container mx-auto px-6 py-8">
            <!-- Sections will be dynamically generated here by JS -->
        </main>

        <!-- Signature Inputs -->
        <div class="container mx-auto px-6 py-4 no-print">
            <div class="flex justify-between items-center gap-8">
                <input type="text" id="activity-leader-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø±Ø§Ø¦Ø¯/Ø© Ø§Ù„Ù†Ø´Ø§Ø·" class="w-1/2 p-2 text-center bg-transparent border-b-2 border-gray-300 focus:border-teal-500 outline-none" onblur="saveState()">
                <input type="text" id="school-director-name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø¯ÙŠØ±/Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©" class="w-1/2 p-2 text-center bg-transparent border-b-2 border-gray-300 focus:border-teal-500 outline-none" onblur="saveState()">
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-4 text-center no-print">
            <div class="container mx-auto flex justify-center items-center">
                <a href="https://t.me/+SJnY9vPy7yo5YmI1" target="_blank" class="ml-4">
                    <img src="https://e.top4top.io/p_3463x5tj40.png" alt="Ø´Ø¹Ø§Ø± Ù‚Ù†Ø§Ø© Ø±Ø³Ù…" class="h-20 w-auto">
                </a>
                <span>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù‚Ù†Ø§Ø© Ø±Ø³Ù… Ù„Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© 2025</span>
            </div>
        </footer>
    </div>

    <script>
        // State and Data
        let selectedStages = ['all'];
        let currentRegion = 'other';
        let activeRowIndex = null;
        let tempSelectedDates = [];
        let isPrinting = false; // Flag to prevent multiple print dialogs

        const weeksDataDefault = {
            'week1': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', startDate: '1 / 3', endDate: '5 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 3' } },
            'week2': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', startDate: '8 / 3', endDate: '12 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 3' } },
            'week3': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«', startDate: '15 / 3', endDate: '19 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '15 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '16 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '17 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '18 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '19 / 3' } },
            'week4': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹', startDate: '22 / 3', endDate: '26 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '22 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '23 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '24 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '25 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '26 / 3' } },
            'week5': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³', startDate: '29 / 3', endDate: '3 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '29 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '30 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '1 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '2 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '3 / 4' }, specialDays: { '1 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', color: 'green' } } },
            'week6': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³', startDate: '6 / 4', endDate: '10 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '6 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '7 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '8 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '9 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '10 / 4' } },
            'week7': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹', startDate: '13 / 4', endDate: '17 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '13 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '14 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '15 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '16 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '17 / 4' } },
            'week8': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù†', startDate: '20 / 4', endDate: '24 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '20 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '21 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '22 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '23 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '24 / 4' }, specialDays: { '20 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week9': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ø³Ø¹', startDate: '27 / 4', endDate: '1 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '27 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '28 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '29 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '30 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '1 / 5' } },
            'week10': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø´Ø±', startDate: '4 / 5', endDate: '8 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '4 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '5 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '6 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '7 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '8 / 5' } },
            'week11': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±', startDate: '11 / 5', endDate: '15 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '11 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '12 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '13 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '14 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '15 / 5' } },
            'week12': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', startDate: '18 / 5', endDate: '22 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '18 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '19 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '20 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '21 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '22 / 5' } },
            'week13': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±', startDate: '25 / 5', endDate: '29 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '25 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '26 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '27 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '28 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '29 / 5' } },
            'week14': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '9 / 6', endDate: '13 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '9 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '10 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '11 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '12 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '13 / 6' } },
            'week15': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±', startDate: '16 / 6', endDate: '20 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '16 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '17 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '18 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '19 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '20 / 6' }, specialDays: { '20 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week16': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±', startDate: '23 / 6', endDate: '27 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '23 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '24 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '25 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '26 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '27 / 6' }, specialDays: { '23 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week17': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '1 / 7', endDate: '5 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 7' } },
            'week18': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù† Ø¹Ø´Ø±', startDate: '8 / 7', endDate: '12 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 7' } },
        };

        const weeksDataWestern = {
            'week1': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø£ÙˆÙ„', startDate: '8 / 3', endDate: '12 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 3' } },
            'week2': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ', startDate: '15 / 3', endDate: '19 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '15 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '16 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '17 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '18 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '19 / 3' } },
            'week3': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø«', startDate: '22 / 3', endDate: '26 / 3', days: { 'Ø§Ù„Ø£Ø­Ø¯': '22 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '23 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '24 / 3', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '25 / 3', 'Ø§Ù„Ø®Ù…ÙŠØ³': '26 / 3' } },
            'week4': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹', startDate: '29 / 3', endDate: '3 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '29 / 3', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '30 / 3', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '1 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '2 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '3 / 4' }, specialDays: { '1 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', color: 'green' } } },
            'week5': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³', startDate: '6 / 4', endDate: '10 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '6 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '7 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '8 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '9 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '10 / 4' } },
            'week6': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³', startDate: '13 / 4', endDate: '17 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '13 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '14 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '15 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '16 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '17 / 4' } },
            'week7': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹', startDate: '20 / 4', endDate: '24 / 4', days: { 'Ø§Ù„Ø£Ø­Ø¯': '20 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '21 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '22 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '23 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '24 / 4' }, specialDays: { '20 / 4': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week8': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù…Ù†', startDate: '27 / 4', endDate: '1 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '27 / 4', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '28 / 4', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '29 / 4', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '30 / 4', 'Ø§Ù„Ø®Ù…ÙŠØ³': '1 / 5' } },
            'week9': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„ØªØ§Ø³Ø¹', startDate: '4 / 5', endDate: '8 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '4 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '5 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '6 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '7 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '8 / 5' } },
            'week10': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø¹Ø§Ø´Ø±', startDate: '11 / 5', endDate: '15 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '11 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '12 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '13 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '14 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '15 / 5' } },
            'week11': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±', startDate: '18 / 5', endDate: '22 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '18 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '19 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '20 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '21 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '22 / 5' } },
            'week12': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±', startDate: '25 / 5', endDate: '29 / 5', days: { 'Ø§Ù„Ø£Ø­Ø¯': '25 / 5', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '26 / 5', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '27 / 5', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '28 / 5', 'Ø§Ù„Ø®Ù…ÙŠØ³': '29 / 5' } },
            'week13': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±', startDate: '9 / 6', endDate: '13 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '9 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '10 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '11 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '12 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '13 / 6' } },
            'week14': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '16 / 6', endDate: '20 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '16 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '17 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '18 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '19 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '20 / 6' }, specialDays: { '20 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week15': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±', startDate: '23 / 6', endDate: '27 / 6', days: { 'Ø§Ù„Ø£Ø­Ø¯': '23 / 6', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '24 / 6', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '25 / 6', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '26 / 6', 'Ø§Ù„Ø®Ù…ÙŠØ³': '27 / 6' }, specialDays: { '23 / 6': { name: 'Ø¥Ø¬Ø§Ø²Ø© Ø¥Ø¶Ø§ÙÙŠØ©', color: 'red' } } },
            'week16': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø¹Ø´Ø±', startDate: '1 / 7', endDate: '5 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '1 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '2 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '3 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '4 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '5 / 7' } },
            'week17': { name: 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ Ø§Ù„Ø³Ø§Ø¨Ø¹ Ø¹Ø´Ø±', startDate: '8 / 7', endDate: '12 / 7', days: { 'Ø§Ù„Ø£Ø­Ø¯': '8 / 7', 'Ø§Ù„Ø§Ø«Ù†ÙŠÙ†': '9 / 7', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡': '10 / 7', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡': '11 / 7', 'Ø§Ù„Ø®Ù…ÙŠØ³': '12 / 7' } },
        };
        
        let weeksData = weeksDataDefault;

        const activitiesData = [
            { id: 'citizenship', title: 'Ø§Ù„Ù…ÙˆØ§Ø·Ù†Ø© ÙˆØ§Ù„Ø­ÙŠØ§Ø©', color: '#981E47', icon: 'https://k.top4top.io/p_3472ccl2l0.gif', programs: [
                { name: 'Ø§Ù„ØªØ·ÙˆØ¹ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ', sessions: { primary: 4, 'upper-primary': 6, middle: 5, high: 5 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø·Ù…ÙˆØ­Ø©', sessions: { primary: 6, 'upper-primary': 4, middle: 3, high: 2 } },
                { name: 'Ù‚ÙŠÙ…Ù†Ø§ Ø­ÙŠØ§Ø©', sessions: { primary: 0, 'upper-primary': 12, middle: 12, high: 12 } },
            ]},
            { id: 'culture', title: 'Ø§Ù„Ø«Ù‚Ø§ÙØ© ÙˆØ§Ù„ÙÙ†ÙˆÙ†', color: '#FF7145', icon: 'https://a.top4top.io/p_3472miame2.gif', programs: [
                 { name: 'Ø§Ù„ÙÙ† Ø§Ù„Ø³Ø§Ø¨Ø¹ (Ø§Ù„Ø³ÙŠÙ†Ù…Ø§)', sessions: { primary: 8, 'upper-primary': 8, middle: 8, high: 8 } },
                 { name: 'Ø­Ø¯Ø§Ø¦Ù‚ Ø§Ù„ÙÙ†', sessions: { primary: 6, 'upper-primary': 6, middle: 6, high: 6 } },
                 { name: 'Ø§Ù„Ø£Ø²ÙŠØ§Ø¡ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', sessions: { primary: 4, 'upper-primary': 4, middle: 6, high: 6 } },
                 { name: 'Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù…ÙŠØ©', sessions: { primary: 4, 'upper-primary': 4, middle: 6, high: 8 } },
                 { name: 'ØªØµØ§Ù…ÙŠÙ… ØªØ±Ø§Ø«ÙŠØ© Ù…Ø¹Ø§ØµØ±Ø©', sessions: { primary: 5, 'upper-primary': 5, middle: 5, high: 5 } },
                 { name: 'Ø§Ù„ÙÙ†ÙˆÙ† Ø§Ù„Ù…Ø³Ø±Ø­ÙŠØ©', sessions: { primary: 8, 'upper-primary': 8, middle: 8, high: 8 } },
                 { name: 'Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚ÙŠ (Ø§Ù„Ø£Ù†Ø§Ø´ÙŠØ¯ Ø§Ù„ÙˆØ·Ù†ÙŠØ©)', sessions: { primary: 8, 'upper-primary': 8, middle: 8, high: 8 } },
                 { name: 'Ø­ÙƒØ§ÙŠØ§Øª Ù…Ø±Ø¦ÙŠØ©', sessions: { primary: 6, 'upper-primary': 6, middle: 11, high: 11 } },
            ]},
            { id: 'sports', title: 'Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆØ§Ù„ØµØ­Ø©', color: '#2FB7BD', icon: 'https://c.top4top.io/p_3472urwbn4.gif', programs: [
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©', sessions: { primary: 6, 'upper-primary': 8, middle: 8, high: 8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©', sessions: { primary: 8, 'upper-primary': 8, middle: 8, high: 6 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¯ÙØ§Ø¹ Ø¹Ù† Ø§Ù„Ù†ÙØ³', sessions: { primary: 8, 'upper-primary': 8, middle: 8, high: 6 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØ§Ù„ØªØ±ÙÙŠÙ‡', sessions: { primary: 8, 'upper-primary': 8, middle: 6, high: 8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø°Ù‡Ù†ÙŠØ©', sessions: { primary: 6, 'upper-primary': 8, middle: 8, high: 8 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£ÙˆÙ„Ù…Ø¨ÙŠØ§Ø¯ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ', sessions: { primary: 6, 'upper-primary': 8, middle: 8, high: 8 } },
            ]},
            { id: 'science', title: 'Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©', color: '#24344D', icon: 'https://l.top4top.io/p_3472daolv1.gif', programs: [
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ·Ø¨ÙŠÙ‚Ø§Øª STEM', sessions: { primary: 3, 'upper-primary': 5, middle: 7, high: 7 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„ØªØµØ§Ù…ÙŠÙ… Ø§Ù„Ø¹Ù„Ù…ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ©', sessions: { primary: 2, 'upper-primary': 5, middle: 7, high: 7 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø±ÙˆØ§Ø¯ ÙØ¶Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„', sessions: { primary: 3, 'upper-primary': 5, middle: 7, high: 9 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…Ø¯Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„', sessions: { primary: 3, 'upper-primary': 4, middle: 7, high: 9 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', sessions: { primary: 10, 'upper-primary': 10, middle: 10, high: 10 } },
                { name: 'Ø¨Ø±Ù†Ø§Ù…Ø¬ ØªØ­Ø¯ÙŠ Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø£Ø´ÙŠØ§Ø¡', sessions: { primary: 3, 'upper-primary': 4, middle: 7, high: 9 } },
            ]},
            { id: 'scouting', title: 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙƒØ´ÙÙŠ', color: '#018083', icon: 'https://b.top4top.io/p_3472h0ngk3.gif', programs: [
                { name: 'Ø®ÙŠÙ…ØªÙŠ Ø§Ù„Ø¬Ù…ÙŠÙ„Ø©', sessions: { primary: 3, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'Ø®Ø´Ø¨Ø© ÙˆØ­Ø¨Ù„', sessions: { primary: 0, 'upper-primary': 12, middle: 0, high: 0 } },
                { name: 'Ø§Ù„Ù…Ù„Ø§Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ§Ø¨Ø³', sessions: { primary: 0, 'upper-primary': 0, middle: 3, high: 0 } },
                { name: 'Ø£ØºØ§Ù…Ø± ÙˆØ£ÙƒØªØ´Ù', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 5 } },
                { name: 'Ø¨Ø±Ø§Ø¹Ù… Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹', sessions: { primary: 2, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'Ø£Ø´Ø§Ø±Ùƒ Ù…Ø¬ØªÙ…Ø¹ÙŠ ÙˆØ£Ø²Ø±Ø¹ Ø´Ø¬Ø±Ø©', sessions: { primary: 0, 'upper-primary': 3, middle: 0, high: 0 } },
                { name: 'Ù…Ø¬ØªÙ…Ø¹ÙŠ ÙˆØ¨ÙŠØ¦ØªÙŠ Ù…Ø³Ø¤ÙˆÙ„ÙŠØªÙŠ', sessions: { primary: 0, 'upper-primary': 0, middle: 6, high: 0 } },
                { name: 'Ø³ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ¦Ø© ÙˆØ§Ù„Ù…Ø¬ØªÙ…Ø¹', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 5 } },
                { name: 'Ø¨ØµÙ…ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { primary: 3, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'ÙˆØ·Ù†ÙŠ ÙÙŠ Ù‚Ù„Ø¨ÙŠ', sessions: { primary: 0, 'upper-primary': 3, middle: 0, high: 0 } },
                { name: 'ØµÙ†Ø§Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±', sessions: { primary: 0, 'upper-primary': 0, middle: 3, high: 0 } },
                { name: 'Ø³ÙˆØ§Ø¹Ø¯ Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 6 } },
                { name: 'Ø¨Ø±Ø§Ø¹Ù… Ø§Ù„Ù†ÙˆØ±', sessions: { primary: 2, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'ÙƒÙ†ÙˆØ² Ø§Ù„ØµØºØ§Ø±', sessions: { primary: 0, 'upper-primary': 2, middle: 0, high: 0 } },
                { name: 'Ù…Ù† Ù‡Ø¯ÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø³Ù†Ø©', sessions: { primary: 0, 'upper-primary': 0, middle: 3, high: 0 } },
                { name: 'Ø¯Ø±Ø¨ Ø§Ù„Ø¥Ø­Ø³Ø§Ù†', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 3 } },
                { name: 'Ø¨ÙˆØµÙ„Ø© Ø§Ù„Ø§ÙƒØªØ´Ø§Ù', sessions: { primary: 3, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'Ø®ÙŠÙ…Ø© Ø§Ù„ØªØ¬Ø§Ø±Ø¨ Ø§Ù„Ù…Ø³Ù„ÙŠØ©', sessions: { primary: 0, 'upper-primary': 6, middle: 0, high: 0 } },
                { name: 'Ù…Ø®ÙŠÙ…ÙŠ Ø§Ù„ØªÙ‚Ù†ÙŠ', sessions: { primary: 0, 'upper-primary': 0, middle: 10, high: 0 } },
                { name: 'ÙˆØ§Ø­Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„ÙƒØ´ÙÙŠ', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 4 } },
                { name: 'Ø¹Ø§Ø¯Ø§ØªÙŠ Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„ÙƒØ´ÙÙŠØ©', sessions: { primary: 3, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'Ø·Ø¨Ù‚ÙŠ Ø§Ù„ÙƒØ´ÙÙŠ', sessions: { primary: 0, 'upper-primary': 3, middle: 0, high: 0 } },
                { name: 'Ø®Ø·ÙˆØ§ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ© Ø§Ù„ØµØ­ÙŠØ©', sessions: { primary: 0, 'upper-primary': 0, middle: 3, high: 0 } },
                { name: 'Ù…Ù‡Ø±Ø¬Ø§Ù† Ø§Ù„Ø£ÙÙ„Ø§Ù… Ø§Ù„ÙƒØ´ÙÙŠØ© Ø§Ù„ØµØ­ÙŠØ©', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 5 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§ØªÙŠ ÙˆÙƒØ´ÙÙŠØªÙŠ', sessions: { primary: 2, 'upper-primary': 0, middle: 0, high: 0 } },
                { name: 'ØµØ§ÙØ±Ø© ÙˆØ§ØµØ·ÙØ§Ù', sessions: { primary: 0, 'upper-primary': 2, middle: 0, high: 0 } },
                { name: 'Ù…Ù‡Ø§Ø±Ø§ØªÙŠ Ø§Ù„ÙƒØ´ÙÙŠØ© Ù…Ù† Ø§Ù„Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø²', sessions: { primary: 0, 'upper-primary': 0, middle: 4, high: 0 } },
                { name: 'Ø£ÙÙ‚ÙŠ Ø§Ù„ÙƒØ´ÙÙŠ Ø§Ù„ÙˆØ§Ø³Ø¹', sessions: { primary: 0, 'upper-primary': 0, middle: 0, high: 6 } },
            ]},
            { id: 'events', title: 'Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª', color: '#583C71', icon: 'https://e.top4top.io/p_34729xucx5.gif', programs: [
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ', date: 'Ù¡ / Ù¤ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 4, 'upper-primary': 4, middle: 4, high: 4 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØªØ³Ø§Ù…Ø­ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ', date: 'Ù¢Ù¥ / Ù¥ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 1, high: 1 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„Ø·ÙÙ„', date: 'Ù¢Ù© / Ù¥ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 0, high: 0 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ø°ÙˆÙŠ Ø§Ù„Ø¥Ø¹Ø§Ù‚Ø©', date: 'Ù¡Ù¢ / Ù¦ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 2, high: 2 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©', date: 'Ù¢Ù§ / Ù¦ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 1, high: 1 } },
                { name: 'Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ Ù„Ù„ØªØ¹Ù„ÙŠÙ…', date: 'Ù§ / Ù¨ / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 2, high: 2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³', date: 'Ù¥ / Ù© / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 4, 'upper-primary': 4, middle: 4, high: 4 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ', date: 'Ù¢Ù¢ / Ù© / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 3, 'upper-primary': 3, middle: 2, high: 2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© Ø§Ù„Ø®Ø¶Ø±Ø§Ø¡', date: 'Ù¨ / Ù¡Ù  / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 3, 'upper-primary': 3, middle: 2, high: 2 } },
                { name: 'ÙŠÙˆÙ… Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ', date: 'Ù¡Ù© / Ù¡Ù  / Ù¡Ù¤Ù¤Ù§ Ù‡Ù€', sessions: { primary: 2, 'upper-primary': 2, middle: 2, high: 2 } },
            ]},
        ];

        function generateSections() {
            const mainContainer = document.querySelector('main');
            mainContainer.innerHTML = ''; // Clear existing sections

            activitiesData.forEach(section => {
                const programRows = section.programs.map((prog, index) => {
                    const uniqueId = `${section.id}-${index}`;
                    return `
                    <tr 
                        data-program-id="${uniqueId}" 
                        data-program-name="${prog.name}" 
                        data-field-name="${section.title}" 
                        data-field-color="${section.color}"
                        data-sessions='${JSON.stringify(prog.sessions)}'
                    >
                        <td class="border border-gray-300 px-2 py-3 font-semibold" style="background-color: ${section.color}; color: white;">${section.title}</td>
                        <td class="border border-gray-300 px-2 py-3">
                            <div>${prog.name}</div>
                            ${prog.date ? `<div class="text-sm text-blue-600 font-semibold pt-1">${prog.date}</div>` : ''}
                            <div class="session-details text-xs text-gray-500 mt-1"></div>
                        </td>
                        <td class="border border-gray-300 px-2 py-3">
                            <textarea placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…/Ø©" class="teacher-input w-full p-1 border rounded text-sm" rows="2" onblur="saveState()"></textarea>
                        </td>
                        <td class="border border-gray-300 px-2 py-3">
                            <select class="duration-select w-full p-1 border rounded text-sm" onchange="saveState()">
                                <option value="1">Ø£Ø³Ø¨ÙˆØ¹ ÙˆØ§Ø­Ø¯</option>
                                <option value="2">Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†</option>
                                <option value="3">Ù£ Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                                <option value="4">Ù¤ Ø£Ø³Ø§Ø¨ÙŠØ¹</option>
                            </select>
                        </td>
                        <td class="border border-gray-300 px-2 py-3 text-center">
                            <button class="date-select-btn bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600" onclick="openDatePicker('${uniqueId}')">Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®</button>
                            <div class="dates-display text-xs mt-1 text-gray-600"></div>
                        </td>
                    </tr>
                `}).join('');

                const sectionHTML = `
                    <section id="${section.id}" class="mb-8">
                        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <button onclick="toggleDropdown('${section.id}-dropdown')" class="w-full px-6 py-4 text-right font-bold text-lg flex justify-between items-center transition-colors hover:bg-gray-50" style="background-color: ${section.color}; color: white;">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 rounded-full bg-white flex items-center justify-center ml-4 overflow-hidden">
                                        <img src="${section.icon}" alt="${section.title}" class="w-8 h-8 object-contain">
                                    </div>
                                    <span>${section.title}</span>
                                </div>
                                <svg id="${section.id}-arrow" class="w-6 h-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div id="${section.id}-dropdown" class="dropdown-content">
                                <div class="p-6">
                                    <div class="overflow-x-auto">
                                        <table class="w-full border-collapse border border-gray-300">
                                            <thead>
                                                <tr class="bg-gray-100">
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-1/6">Ø§Ù„Ù…Ø¬Ø§Ù„</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-2/6">Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ (ÙˆØ§Ù„Ø­ØµØµ)</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-1/6">Ø§Ù„Ù…Ø¹Ù„Ù…/Ø© Ø§Ù„Ù…Ù†ÙØ°/Ø©</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-right font-semibold w-1/6">Ù…Ø¯Ø© Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                                                    <th class="border border-gray-300 px-2 py-3 text-center font-semibold w-1/6">ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                                                </tr>
                                            </thead>
                                            <tbody>${programRows}</tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                `;
                mainContainer.innerHTML += sectionHTML;
            });
             updateSessionDetailsVisibility();
        }

        function selectRegion(region) {
            currentRegion = region;
            weeksData = region === 'western' ? weeksDataWestern : weeksDataDefault;

            const btnWestern = document.getElementById('btn-western-region');
            const btnOther = document.getElementById('btn-other-region');

            if (region === 'western') {
                btnWestern.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg';
                btnOther.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700';
            } else {
                btnOther.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-blue-600 text-white shadow-lg';
                btnWestern.className = 'px-4 py-2 rounded-full font-medium transition-all duration-300 bg-gray-200 text-gray-700';
            }
            saveState();
        }

        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const arrow = document.getElementById(dropdownId.replace('-dropdown', '-arrow'));
            
            document.querySelectorAll('.dropdown-content.active').forEach(openDropdown => {
                if (openDropdown.id !== dropdownId) {
                    openDropdown.classList.remove('active');
                    const otherArrow = document.getElementById(openDropdown.id.replace('-dropdown', '-arrow'));
                    if (otherArrow) otherArrow.classList.remove('rotate-arrow');
                }
            });

            dropdown.classList.toggle('active');
            arrow.classList.toggle('rotate-arrow');
        }

        function toggleStageFilter(stage) {
            if (stage === 'all') {
                selectedStages = ['all'];
            } else {
                if (selectedStages.includes('all')) selectedStages = [];
                if (selectedStages.includes(stage)) {
                    selectedStages = selectedStages.filter(s => s !== stage);
                } else {
                    selectedStages.push(stage);
                }
                if (selectedStages.length === 0) selectedStages = ['all'];
            }
            updateButtonStyles();
            updateTitle();
            updateSessionDetailsVisibility();
            saveState();
        }

        function updateButtonStyles() {
            const buttons = { 'all': 'btn-all', 'primary': 'btn-primary', 'upper-primary': 'btn-upper-primary', 'middle': 'btn-middle', 'high': 'btn-high' };
            Object.keys(buttons).forEach(stage => {
                const btn = document.getElementById(buttons[stage]);
                if (selectedStages.includes(stage)) {
                    btn.classList.add('bg-blue-600', 'text-white', 'shadow-lg');
                    btn.classList.remove('bg-gray-200', 'text-gray-700');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                    btn.classList.add('bg-gray-200', 'text-gray-700');
                }
            });
        }

        function updateTitle() {
            const stageTitleHeader = document.getElementById('stage-title-header');
            const stageNames = { 'primary': 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', 'upper-primary': 'Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§', 'middle': 'Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', 'high': 'Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©' };
            
            if (selectedStages.includes('all') || selectedStages.length === 0) {
                stageTitleHeader.textContent = '';
            } else if (selectedStages.includes('primary') && selectedStages.includes('upper-primary') && selectedStages.length === 2) {
                stageTitleHeader.textContent = 'Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©';
            } else if (selectedStages.length === 1 && !selectedStages.includes('all')) {
                 stageTitleHeader.textContent = `Ù„Ù„Ù…Ø±Ø­Ù„Ø© ${stageNames[selectedStages[0]]}`;
            } else if (!selectedStages.includes('all')) {
                 stageTitleHeader.textContent = selectedStages.map(s => stageNames[s]).join(' - ');
            }
        }
        
        function updateSessionDetailsVisibility() {
            const stageNames = { 'primary': 'Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', 'upper-primary': 'Ø§Ù„Ø¹Ù„ÙŠØ§', 'middle': 'Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', 'high': 'Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©' };
            document.querySelectorAll('tr[data-sessions]').forEach(row => {
                const sessions = JSON.parse(row.dataset.sessions);
                const detailsDiv = row.querySelector('.session-details');
                const dateButton = row.querySelector('.date-select-btn');
                let detailsHtml = '';
                let totalSessions = 0;

                if (selectedStages.includes('all')) {
                    totalSessions = Object.values(sessions).reduce((a, b) => a + b, 0);
                } else {
                    selectedStages.forEach(stage => {
                        totalSessions += sessions[stage] || 0;
                    });
                    detailsHtml = selectedStages.map(stage => {
                        const count = sessions[stage] || 0;
                        return `${stageNames[stage]}: ${count} Ø­ØµØµ`;
                    }).filter(Boolean).join(' | ');
                }
                
                detailsDiv.innerHTML = detailsHtml;

                if (totalSessions === 0 && !selectedStages.includes('all')) {
                    dateButton.disabled = true;
                    dateButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                    dateButton.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                } else {
                    dateButton.disabled = false;
                    dateButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    dateButton.classList.add('bg-blue-500', 'hover:bg-blue-600');
                }
            });
        }

        function clearAllFilters() {
            selectedStages = ['all'];
            updateButtonStyles();
            updateTitle();
            updateSessionDetailsVisibility();
            saveState();
        }

        function openDatePicker(programId) {
            activeRowIndex = programId;
            const row = document.querySelector(`tr[data-program-id="${programId}"]`);
            const duration = parseInt(row.querySelector('.duration-select').value, 10);
            const programName = row.dataset.programName;
            
            document.getElementById('modal-title').textContent = `Ø§Ø®ØªØ± ØªÙˆØ§Ø±ÙŠØ® Ø¨Ø±Ù†Ø§Ù…Ø¬: ${programName}`;
            
            const state = JSON.parse(localStorage.getItem('activityPlanState')) || {};
            const savedProgram = state.programSelections ? state.programSelections[programId] : null;
            tempSelectedDates = savedProgram ? [...savedProgram.dates] : [];

            const container = document.getElementById('modal-weeks-container');
            container.innerHTML = '';

            Object.entries(weeksData).forEach(([weekKey, weekData]) => {
                const weekDiv = document.createElement('div');
                weekDiv.className = 'p-2 border rounded-md';
                weekDiv.innerHTML = `<p class="font-semibold text-center mb-2">${weekData.name} (${weekData.startDate} - ${weekData.endDate})</p>`;
                
                const weekGrid = document.createElement('div');
                weekGrid.className = 'week-grid grid grid-cols-5 gap-2';
                
                Object.entries(weekData.days).forEach(([dayName, dayDate]) => {
                    const dayButton = document.createElement('button');
                    dayButton.className = 'day p-2 border rounded-md text-sm';
                    dayButton.dataset.date = `${dayName} ${dayDate}`;
                    dayButton.dataset.week = weekKey;
                    
                    let buttonText = `${dayName}<br>${dayDate}`;
                    if (weekData.specialDays && weekData.specialDays[dayDate]) {
                        dayButton.classList.add('disabled');
                        dayButton.disabled = true;
                        buttonText += `<br><span class="text-xs">${weekData.specialDays[dayDate].name}</span>`;
                    } else {
                        dayButton.onclick = () => toggleDateSelection(dayButton, duration);
                    }
                    
                    if (tempSelectedDates.includes(dayButton.dataset.date)) {
                        dayButton.classList.add('selected');
                    }
                    
                    dayButton.innerHTML = buttonText;
                    weekGrid.appendChild(dayButton);
                });
                weekDiv.appendChild(weekGrid);
                container.appendChild(weekDiv);
            });

            document.getElementById('date-picker-modal').style.display = 'flex';
        }

        function toggleDateSelection(button, durationInWeeks) {
            const date = button.dataset.date;
            const week = button.dataset.week;
            const isSelected = tempSelectedDates.includes(date);
            const totalMaxDates = durationInWeeks * 3;

            // If already selected, deselect it
            if (isSelected) {
                tempSelectedDates = tempSelectedDates.filter(d => d !== date);
                button.classList.remove('selected');
                return;
            }

            // If not selected, check limits before selecting

            // 1. Check total number of dates limit
            if (tempSelectedDates.length >= totalMaxDates) {
                alert(`Ù„Ù‚Ø¯ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ø¹Ø¯Ø¯ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ù‡Ø°Ø§ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ (${totalMaxDates} ØªÙˆØ§Ø±ÙŠØ®).`);
                return;
            }

            // 2. Check number of dates per week limit (max 3)
            const weekButtons = Array.from(document.querySelectorAll(`#date-picker-modal .day[data-week="${week}"]`));
            const selectedInThisWeekCount = weekButtons.filter(btn => tempSelectedDates.includes(btn.dataset.date)).length;

            if (selectedInThisWeekCount >= 3) {
                alert('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† 3 Ø£ÙŠØ§Ù… ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹.');
                return;
            }

            // All checks passed, so select the date
            tempSelectedDates.push(date);
            button.classList.add('selected');
        }

        function closeDatePicker() {
            document.getElementById('date-picker-modal').style.display = 'none';
            activeRowIndex = null;
            tempSelectedDates = [];
        }

        function saveDates() {
            const row = document.querySelector(`tr[data-program-id="${activeRowIndex}"]`);
            const datesDisplay = row.querySelector('.dates-display');
            datesDisplay.textContent = tempSelectedDates.join(' | ');
            saveState();
            closeDatePicker();
        }
        
        function printSchedule() {
            if (isPrinting) {
                alert('Ø¹Ù…Ù„ÙŠØ© Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø§Ø±ÙŠØ© Ø¨Ø§Ù„ÙØ¹Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.');
                return;
            }
            isPrinting = true;

            const state = JSON.parse(localStorage.getItem('activityPlanState')) || {};
            if (!state) {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©.');
                isPrinting = false;
                return;
            }

            const programSelections = state.programSelections || {};
            const stagesForPrint = state.selectedStages || ['all'];
            
            const plannedPrograms = Object.entries(programSelections)
                .filter(([id, data]) => data.dates && data.dates.length > 0)
                .map(([id, data]) => {
                    const row = document.querySelector(`tr[data-program-id="${id}"]`);
                    const sessionsData = JSON.parse(row.dataset.sessions);
                    
                    let totalSessions = 0;
                    let sessionDetails = '';
                    const stageNames = { 'primary': 'Ø§Ù„Ø£ÙˆÙ„ÙŠØ©', 'upper-primary': 'Ø§Ù„Ø¹Ù„ÙŠØ§', 'middle': 'Ø§Ù„Ù…ØªÙˆØ³Ø·Ø©', 'high': 'Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©' };

                    if (stagesForPrint.includes('all')) {
                        totalSessions = Object.values(sessionsData).reduce((sum, val) => sum + val, 0);
                        sessionDetails = 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„';
                    } else {
                        sessionDetails = stagesForPrint.map(stage => {
                            const count = sessionsData[stage] || 0;
                            if(count > 0) totalSessions += count;
                            return count > 0 ? `${stageNames[stage]}: ${count}` : '';
                        }).filter(Boolean).join('ØŒ ');
                    }

                    return {
                        field: row.dataset.fieldName,
                        program: row.dataset.programName,
                        teacher: data.teacher || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯',
                        dates: data.dates || [],
                        color: row.dataset.fieldColor,
                        totalSessions: totalSessions,
                        sessionDetails: sessionDetails,
                        duration: parseInt(data.duration, 10)
                    };
                }).filter(p => p.totalSessions > 0);

            if (plannedPrograms.length === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø±Ø§Ø­Ù„ ÙˆØªØ­Ø¯ÙŠØ¯ ØªÙˆØ§Ø±ÙŠØ® Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.');
                isPrinting = false;
                return;
            }

            const printWindow = window.open('', '_blank');
            if (!printWindow) {
                alert('ÙØ´Ù„ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹.');
                isPrinting = false;
                return;
            }

            let printStageTitle = document.getElementById('stage-title-header').textContent || 'Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©';
            const printSemesterSubtitle = 'Ø§Ù„ÙØµÙ„ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„Ø¹Ø§Ù… Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ Ù¡Ù¤Ù¤Ù§ Ù‡Ù€';
            const eduAdmin = state.educationAdmin || '';
            const eduRegion = state.educationRegion || '';
            const schoolName = state.schoolName || '';
            const leaderName = state.activityLeaderName || '';
            const directorName = state.schoolDirectorName || '';
            
            const programsByField = {};
            plannedPrograms.forEach(p => {
                if (!programsByField[p.field]) {
                    programsByField[p.field] = [];
                }
                programsByField[p.field].push(p);
            });

            const printLayoutOrder = [
                ['Ø§Ù„Ù…ÙˆØ§Ø·Ù†Ø© ÙˆØ§Ù„Ø­ÙŠØ§Ø©', 'Ø§Ù„Ø«Ù‚Ø§ÙØ© ÙˆØ§Ù„ÙÙ†ÙˆÙ†'],
                ['Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆØ§Ù„ØµØ­Ø©', 'Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙ‚Ù†ÙŠØ©'],
                ['Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„ÙƒØ´ÙÙŠ', 'Ø§Ù„Ø£ÙŠØ§Ù… ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª']
            ];

            let printContent = '<div class="print-grid">';
            printLayoutOrder.forEach(row => {
                printContent += '<div class="print-row">';
                row.forEach(fieldName => {
                    printContent += '<div class="print-column">';
                    if (programsByField[fieldName]) {
                        const fieldData = activitiesData.find(f => f.title === fieldName);
                        printContent += `<h3 style="background-color:${fieldData.color}; color:white; padding: 5px; border-radius: 5px 5px 0 0;">${fieldName}</h3>`;
                        
                        let tableRows = programsByField[fieldName].map(p => {
                            const parseDate = (dateStr) => {
                                const parts = dateStr.split(' '); 
                                const day = parseInt(parts[1], 10);
                                const month = parseInt(parts[3], 10);
                                return month * 100 + day; 
                            };

                            const datesByWeek = {};

                            p.dates.forEach(dateStr => {
                                const dateOnly = dateStr.split(' ').slice(1).join(' '); 
                                const weekKey = Object.keys(weeksData).find(wk => Object.values(weeksData[wk].days).includes(dateOnly));
                                
                                if (weekKey) {
                                    if (!datesByWeek[weekKey]) datesByWeek[weekKey] = [];
                                    datesByWeek[weekKey].push(dateStr);
                                }
                            });

                            const formattedDatesArray = Object.keys(datesByWeek).map(weekKey => {
                                const weekName = weeksData[weekKey].name;
                                const sortedDates = datesByWeek[weekKey].sort((a, b) => parseDate(a) - parseDate(b));
                                const dateParts = sortedDates.join(' - ');
                                return `${weekName} : ${dateParts}`;
                            });

                            const formattedDatesString = formattedDatesArray.join('<br>');

                            return `
                            <tr>
                                <td>${p.program}<br><small style="color: #555; font-weight: normal;">(${p.sessionDetails})</small></td>
                                <td>${p.teacher.replace(/\n/g, '<br>')}</td>
                                <td>${formattedDatesString}</td>
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        `}).join('');

                        printContent += `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th>
                                        <th>Ø§Ù„Ù…Ø¹Ù„Ù…/Ø©</th>
                                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th>
                                        <th>Ù†ÙØ°</th>
                                        <th>Ù„Ù… ÙŠÙ†ÙØ°</th>
                                        <th>Ø§Ù„ØªÙˆÙ‚ÙŠØ¹</th>
                                    </tr>
                                </thead>
                                <tbody>${tableRows}</tbody>
                            </table>
                        `;
                    }
                    printContent += '</div>';
                });
                printContent += '</div>';
            });
            printContent += '</div>';

            printWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ar" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <title>Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ Ù„Ù€ ${schoolName}</title>
                    <style>
                        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
                        /* START OF CHANGE: Added universal selector to force color printing */
                        * {
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                        }
                        /* END OF CHANGE */
                        @page { 
                            size: A4 landscape; 
                            margin: 0; 
                        }
                        html, body {
                            height: 100%;
                            margin: 0;
                            padding: 0;
                        }
                        body { 
                            font-family: 'Cairo', sans-serif; 
                            font-size: 8px; 
                            display: flex;
                            flex-direction: column;
                        }
                        .print-gradient-top {
                            height: 30px;
                            background: linear-gradient(to left, #00A383, #0093B5);
                            flex-shrink: 0;
                        }
                        .print-gradient-bottom {
                            height: 15px;
                            background: linear-gradient(to left, #00A383, #0093B5);
                            flex-shrink: 0;
                        }
                        .print-content-wrapper {
                            padding: 5mm;
                            flex-grow: 1;
                            display: flex;
                            flex-direction: column;
                        }
                        .print-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; flex-shrink: 0; }
                        .print-header .right-side { display: flex; align-items: center; gap: 8px; }
                        .print-header img { height: 40px; }
                        .print-header .header-text { font-size: 7px; line-height: 1.2; }
                        .print-header .header-text p { margin: 0; }
                        .print-header .title-container { text-align: center; }
                        .print-header h1 { color: #00A383; margin: 0; font-size: 15px; }
                        .print-header h2 { font-size: 13px; font-weight: bold; color: #0093B5; margin: 1px 0; }
                        .print-header p { color: #555; margin-top: 2px; font-size: 9px; }
                        .print-grid { display: grid; grid-template-rows: auto auto auto; gap: 8px; flex-grow: 1; }
                        .print-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; page-break-inside: avoid; }
                        .print-column { page-break-inside: avoid; }
                        .print-column h3 { font-size: 10px; padding: 3px; border-radius: 4px 4px 0 0; margin: 0; }
                        table { width: 100%; border-collapse: collapse; font-size: 7px; }
                        th, td { border: 1px solid #ccc; padding: 2px; text-align: right; vertical-align: middle; word-wrap: break-word; font-weight: normal; }
                        th { background-color: #f2f2f2; font-weight: bold; }
                        table th:nth-child(1), table td:nth-child(1) { width: 24%; }
                        table th:nth-child(2), table td:nth-child(2) { width: 16%; }
                        table th:nth-child(3), table td:nth-child(3) { width: 42%; }
                        table th:nth-child(4), table td:nth-child(4) { width: 6%; }
                        table th:nth-child(5), table td:nth-child(5) { width: 6%; }
                        table th:nth-child(6), table td:nth-child(6) { width: 6%; }
                        .print-signatures { display: flex; justify-content: space-around; margin-top: auto; padding-top: 10px; font-size: 9px; font-weight: bold; page-break-inside: avoid; flex-shrink: 0; }
                        .signature-box { text-align: center; }
                    </style>
                </head>
                <body>
                    <div class="print-gradient-top"></div>
                    <div class="print-content-wrapper">
                        <div class="print-header">
                            <div class="right-side">
                                <img src="https://salogos.org/wp-content/uploads/2021/11/UntiTtled-1-1300x988.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„ÙˆØ²Ø§Ø±Ø©">
                                <div class="header-text">
                                    <p>${eduAdmin}</p>
                                    <p>${eduRegion}</p>
                                    <p>${schoolName}</p>
                                </div>
                            </div>
                            <div class="title-container">
                                <h1>Ø®Ø·Ø© Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</h1>
                                <h2>${printStageTitle}</h2>
                                <p>${printSemesterSubtitle}</p>
                            </div>
                            <div></div> 
                        </div>
                        ${printContent}
                        <div class="print-signatures">
                            <div class="signature-box">
                                <p>${leaderName}</p>
                            </div>
                            <div class="signature-box">
                                <p>${directorName}</p>
                            </div>
                        </div>
                    </div>
                    <div class="print-gradient-bottom"></div>
                </body>
                </html>
            `);
            
            printWindow.document.close();
            
            printWindow.onafterprint = function() {
                printWindow.close();
                isPrinting = false; 
            };

            setTimeout(() => {
                try {
                    printWindow.print();
                } catch (e) {
                    console.error("Print failed:", e);
                    isPrinting = false; 
                    printWindow.close();
                }
            }, 500);
        }
        
        function saveState() {
            const programSelections = {};
            document.querySelectorAll('main tr[data-program-id]').forEach(row => {
                const id = row.dataset.programId;
                const teacher = row.querySelector('.teacher-input').value;
                const duration = row.querySelector('.duration-select').value;
                const datesText = row.querySelector('.dates-display').textContent;
                const dates = datesText ? datesText.split(' | ') : [];

                if (teacher || duration !== '1' || dates.length > 0) {
                    programSelections[id] = { teacher, duration, dates };
                }
            });

            const state = {
                educationAdmin: document.getElementById('education-admin').value,
                educationRegion: document.getElementById('education-region').value,
                schoolName: document.getElementById('school-name').value,
                activityLeaderName: document.getElementById('activity-leader-name').value,
                schoolDirectorName: document.getElementById('school-director-name').value,
                currentRegion: currentRegion,
                selectedStages: selectedStages,
                programSelections: programSelections,
            };
            localStorage.setItem('activityPlanState', JSON.stringify(state));
        }

        function loadState() {
            const savedState = localStorage.getItem('activityPlanState');
            if (savedState) {
                const state = JSON.parse(savedState);
                
                document.getElementById('education-admin').value = state.educationAdmin || '';
                document.getElementById('education-region').value = state.educationRegion || '';
                document.getElementById('school-name').value = state.schoolName || '';
                document.getElementById('activity-leader-name').value = state.activityLeaderName || '';
                document.getElementById('school-director-name').value = state.schoolDirectorName || '';

                selectRegion(state.currentRegion || 'other');
                
                selectedStages = state.selectedStages || ['all'];
                updateButtonStyles();
                updateTitle();
                updateSessionDetailsVisibility();
                
                if (state.programSelections) {
                    Object.entries(state.programSelections).forEach(([id, data]) => {
                        const row = document.querySelector(`tr[data-program-id="${id}"]`);
                        if (row) {
                            row.querySelector('.teacher-input').value = data.teacher || '';
                            row.querySelector('.duration-select').value = data.duration || '1';
                            row.querySelector('.dates-display').textContent = (data.dates || []).join(' | ');
                        }
                    });
                }
            }
        }

        function resetPlan() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø¨Ø¯Ø¡ Ù…Ù† Ø¬Ø¯ÙŠØ¯ØŸ')) {
                localStorage.removeItem('activityPlanState');
                location.reload();
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            generateSections();
            loadState();
        });
    </script>
</body>
</html>
